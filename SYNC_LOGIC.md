# –õ–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ YNAB Loan Sync

## üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Delta API** YNAB –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

---

## üìã –°—Ü–µ–Ω–∞—Ä–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 1Ô∏è‚É£ **–°–û–ó–î–ê–ù–ò–ï –Ω–æ–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

**–ï—Å–ª–∏ —Å–æ–∑–¥–∞–Ω–∞ –ò–°–•–û–î–ù–ê–Ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞ loan account:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:
  - –í –ª–∏—á–Ω–æ–º –±—é–¥–∂–µ—Ç–µ –Ω–∞ "Account for Innerly": -100 EUR
  - Memo: "Test Loan"

‚Üì Sync –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ó–ï–†–ö–ê–õ–û:
  - –í –±—é–¥–∂–µ—Ç–µ Innerly –Ω–∞ "Account for Alex": +117 USD
  - Memo: "Test Loan | Sync"
  - Payee: (–ø—É—Å—Ç–æ–π)
  - import_id: "LOAN:P:..." (–¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–µ–π)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –≤ –æ–±–∞ –±—é–¥–∂–µ—Ç–∞ —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –≤–∞–ª—é—Ç.

---

### 2Ô∏è‚É£ **–ò–ó–ú–ï–ù–ï–ù–ò–ï —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

#### –°—Ü–µ–Ω–∞—Ä–∏–π A: –ò–∑–º–µ–Ω–µ–Ω–∞ –ò–°–•–û–î–ù–ê–Ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç –∏—Å—Ö–æ–¥–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:
  - –ë—ã–ª–æ: -100 EUR
  - –°—Ç–∞–ª–æ: -150 EUR

‚Üì Delta API –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ

‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –û–ë–ù–û–í–õ–Ø–ï–¢ –∑–µ—Ä–∫–∞–ª–æ:
  - –ë—ã–ª–æ: +117 USD
  - –°—Ç–∞–ª–æ: +175.5 USD (–ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–æ –ø–æ –∫—É—Ä—Å—É)
  - Memo –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
  - –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
```

**–õ–æ–≥–∏–∫–∞:**
1. –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è —á—Ç–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ (–µ—Å—Ç—å mapping)
2. –°—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –≤ –ë–î
3. –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å —Å—É–º–º–∞/–¥–∞—Ç–∞ ‚Üí –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–µ—Ä–∫–∞–ª–æ
4. –ó–µ—Ä–∫–∞–ª—å–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ YNAB API
5. Mapping –≤ –ë–î –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**–ö–æ–¥:** `handleSourceUpdate()` –≤ `src/services/sync.ts`

---

#### –°—Ü–µ–Ω–∞—Ä–∏–π B: –ò–∑–º–µ–Ω–µ–Ω–∞ –ó–ï–†–ö–ê–õ–¨–ù–ê–Ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ –º–µ–Ω—è–µ—Ç –∑–µ—Ä–∫–∞–ª–æ –≤—Ä—É—á–Ω—É—é:
  - –ë—ã–ª–æ: +117 USD
  - –°—Ç–∞–ª–æ: +200 USD (–∏–∑–º–µ–Ω–µ–Ω–æ –≤—Ä—É—á–Ω—É—é –≤ YNAB)

‚Üì Delta API –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ

‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–¢ –∑–µ—Ä–∫–∞–ª–æ:
  - –ü–æ–ª—É—á–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (-100 EUR)
  - –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—É–º–º—É (+117 USD)
  - –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–µ—Ä–∫–∞–ª–æ –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é
```

**–õ–æ–≥–∏–∫–∞:**
1. –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è —á—Ç–æ —ç—Ç–æ –∑–µ—Ä–∫–∞–ª—å–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è (import_id –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 'LOAN:')
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –ª–∏ –æ–Ω–∞
3. –ï—Å–ª–∏ –¥–∞ ‚Üí –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∏—Å—Ö–æ–¥–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
4. –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—É–º–º–∞
5. –ó–µ—Ä–∫–∞–ª–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é

**–ö–æ–¥:** `handleMirrorUpdate()` –≤ `src/services/sync.ts`

**–¶–µ–ª—å:** –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–µ—Ä–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –ó–µ—Ä–∫–∞–ª–æ –≤—Å–µ–≥–¥–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏—Å—Ö–æ–¥–Ω–æ–π.

---

### 3Ô∏è‚É£ **–£–î–ê–õ–ï–ù–ò–ï —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

#### –°—Ü–µ–Ω–∞—Ä–∏–π A: –£–¥–∞–ª–µ–Ω–∞ –ò–°–•–û–î–ù–ê–Ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—è–µ—Ç –∏—Å—Ö–æ–¥–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:
  - –£–¥–∞–ª—è–µ—Ç -100 EUR –∏–∑ –ª–∏—á–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞

‚Üì Delta API: deleted: true

‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –£–î–ê–õ–Ø–ï–¢ –∑–µ—Ä–∫–∞–ª–æ:
  - –£–¥–∞–ª—è–µ—Ç +117 USD –∏–∑ –±—é–¥–∂–µ—Ç–∞ Innerly
  - –û–±–Ω–æ–≤–ª—è–µ—Ç mapping: sync_status = 'deleted'
```

**–õ–æ–≥–∏–∫–∞:**
1. Delta API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å `deleted: true`
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è import_id - —ç—Ç–æ –ù–ï –∑–µ—Ä–∫–∞–ª–æ (–Ω–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å–∞ 'LOAN:')
3. –ù–∞—Ö–æ–¥–∏—Ç—Å—è mapping –≤ –ë–î
4. –£–¥–∞–ª—è–µ—Ç—Å—è –∑–µ—Ä–∫–∞–ª—å–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —á–µ—Ä–µ–∑ YNAB API
5. Mapping –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ 'deleted'

**–ö–æ–¥:** `handleDeletedTransaction()` ‚Üí –≤–µ—Ç–∫–∞ "source transaction deleted"

---

#### –°—Ü–µ–Ω–∞—Ä–∏–π B: –£–¥–∞–ª–µ–Ω–∞ –ó–ï–†–ö–ê–õ–¨–ù–ê–Ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ —É–¥–∞–ª—è–µ—Ç –∑–µ—Ä–∫–∞–ª–æ:
  - –£–¥–∞–ª—è–µ—Ç +117 USD –∏–∑ Innerly

‚Üì Delta API: deleted: true

‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ü–ï–†–ï–°–û–ó–î–ê–Å–¢ –∑–µ—Ä–∫–∞–ª–æ:
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –∏—Å—Ö–æ–¥–Ω–∞—è (-100 EUR) –≤—Å–µ –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  - –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—É–º–º—É
  - –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–µ –∑–µ—Ä–∫–∞–ª–æ (+117 USD)
```

**–õ–æ–≥–∏–∫–∞:**
1. Delta API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å `deleted: true`
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è import_id - —ç—Ç–æ –ó–ï–†–ö–ê–õ–û (–µ—Å—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å 'LOAN:')
3. –ù–∞—Ö–æ–¥–∏—Ç—Å—è mapping –≤ –ë–î
4. –ü–æ–ª—É—á–∞–µ—Ç—Å—è –∏—Å—Ö–æ–¥–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏–∑ YNAB
5. –ï—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω–∞—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–µ—Ä–∫–∞–ª–æ
6. –ï—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω–∞—è —Ç–æ–∂–µ —É–¥–∞–ª–µ–Ω–∞ ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç—Å—è

**–ö–æ–¥:** `handleDeletedTransaction()` ‚Üí –≤–µ—Ç–∫–∞ "mirror transaction deleted"

**–¶–µ–ª—å:** –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∑–µ—Ä–∫–∞–ª. –ó–µ—Ä–∫–∞–ª–æ –≤—Å–µ–≥–¥–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ø–æ–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏—Å—Ö–æ–¥–Ω–∞—è.

---

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤ –∏ –¥—É–±–ª–µ–π

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ import_id
–ö–∞–∂–¥–æ–µ –∑–µ—Ä–∫–∞–ª–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º `import_id`:
```
LOAN:P:819ed0490558  // P = Personal (–∏—Å—Ç–æ—á–Ω–∏–∫)
LOAN:C:be774581330a  // C = Company (–∏—Å—Ç–æ—á–Ω–∏–∫)
```

- YNAB –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª—å —Å —Ç–∞–∫–∏–º –∂–µ `import_id`
- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª—å ‚Üí YNAB –≤–µ—Ä–Ω–µ—Ç 409 Conflict

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ mapping –≤ –ë–î
–ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∑–µ—Ä–∫–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:
```typescript
const existingMapping = await supabase.getTransactionMapping(transaction.id);
if (existingMapping) {
  // –£–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ - –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
  // ...
}
```

### 3. –ü—Ä–æ–ø—É—Å–∫ –∑–µ—Ä–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
```typescript
if (transaction.import_id?.startsWith('LOAN:')) {
  // –≠—Ç–æ –∑–µ—Ä–∫–∞–ª–æ - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è
  // –ù–ï —Å–æ–∑–¥–∞–µ–º –∑–µ—Ä–∫–∞–ª–æ –∑–µ—Ä–∫–∞–ª–∞!
}
```

---

## üí± –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç

### –ú–µ—Ö–∞–Ω–∏–∑–º:
1. –î–∞—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Üí –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –º–µ—Å—è—Ü (YYYY-MM)
2. –ò–∑ –ë–î Supabase –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫—É—Ä—Å –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Å—è—Ü–∞
3. –°—É–º–º–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è: `amount * exchange_rate`
4. –ó–Ω–∞–∫ –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è: –¥–æ—Ö–æ–¥ ‚Üî —Ä–∞—Å—Ö–æ–¥

### –ü—Ä–∏–º–µ—Ä:
```
–ò—Å—Ö–æ–¥–Ω–∞—è: -100.00 EUR, –¥–∞—Ç–∞: 2026-01-15
–ú–µ—Å—è—Ü: 2026-01
–ö—É—Ä—Å –∏–∑ –ë–î: 1.17
–ó–µ—Ä–∫–∞–ª–æ: -((-100.00) * 1.17) = +117.00 USD
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤:
–ö—É—Ä—Å—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `exchange_rates`:
```sql
INSERT INTO exchange_rates (month, eur_to_usd, source)
VALUES ('2026-02', 1.05, 'manual');
```

---

## üìä Delta API (–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

**–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫:**
```
GET /budgets/{id}/transactions?since_date=2026-01-01
‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: 43 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ + server_knowledge=12345
‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ–º: last_server_knowledge=12345
```

**–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏:**
```
GET /budgets/{id}/transactions?since_date=2026-01-01&last_knowledge_of_server=12345
‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Å –º–æ–º–µ–Ω—Ç–∞ 12345
‚Üí –û–±–Ω–æ–≤–ª—è–µ–º: last_server_knowledge=12350
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ –ú–∏–Ω–∏–º—É–º —Ç—Ä–∞—Ñ–∏–∫–∞ (—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏–π (`deleted: true`)
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Ä–∞–±–æ—Ç–∞ –¥–∞–∂–µ —Å —Ç—ã—Å—è—á–∞–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

---

## üîç –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è loan —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è loan —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π –µ—Å–ª–∏:

```typescript
// –î–ª—è Personal ‚Üí Company:
transaction.account_id === loanAccount.personal_account_id

// –î–ª—è Company ‚Üí Personal:
transaction.account_id === loanAccount.company_account_id
```

–ú–∞–ø–ø–∏–Ω–≥ loan accounts —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `loan_accounts`:
- `personal_account_id`: ID –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –ª–∏—á–Ω–æ–º –±—é–¥–∂–µ—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Account for Innerly")
- `company_account_id`: ID –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –±—é–¥–∂–µ—Ç–µ –∫–æ–º–ø–∞–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Account for Alex")
- `company_budget_id`: ID –±—é–¥–∂–µ—Ç–∞ –∫–æ–º–ø–∞–Ω–∏–∏
- `company_name`: –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏

–¢–æ–ª—å–∫–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞ —ç—Ç–∏—Ö —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–∞—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è.

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `sync_log`:

```sql
SELECT 
  action,           -- 'create', 'update', 'delete'
  transaction_id,   -- ID –∏—Å—Ö–æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  mirror_transaction_id,  -- ID –∑–µ—Ä–∫–∞–ª—å–Ω–æ–π
  details,          -- JSON —Å –¥–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
  created_at
FROM sync_log
ORDER BY created_at DESC;
```

–¢–∞–∫–∂–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `sync_state`:
```sql
SELECT 
  budget_name,
  last_server_knowledge,  -- Delta API —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  transactions_synced,
  last_sync_at,
  last_sync_status
FROM sync_state
JOIN budgets_config USING(budget_id);
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env):
```bash
# –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
SYNC_START_DATE=2026-01-01

# –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–º–∏–Ω—É—Ç—ã)
SYNC_INTERVAL_MINUTES=5

# –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
LOG_LEVEL=info
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
- `budgets_config` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±—é–¥–∂–µ—Ç–æ–≤
- `loan_accounts` - –º–∞–ø–ø–∏–Ω–≥ loan –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- `exchange_rates` - –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –ø–æ –º–µ—Å—è—Ü–∞–º
- `transaction_mappings` - —Å–≤—è–∑–∏ –∏—Å—Ö–æ–¥–Ω—ã—Ö –∏ –∑–µ—Ä–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- `sync_state` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (server_knowledge)
- `sync_log` - –ª–æ–≥ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–¢–∏–ø–∏—á–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π):**
```
Alex Personal: 0 transactions
Innerly: 0 transactions
Vibecon: 0 transactions
Total time: ~2 —Å–µ–∫—É–Ω–¥—ã
```

**–ó–∞–ø—É—Å–∫ —Å 1 –Ω–æ–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π:**
```
Alex Personal: 1 transaction (—Å–æ–∑–¥–∞—Ç—å –∑–µ—Ä–∫–∞–ª–æ)
Total time: ~3 —Å–µ–∫—É–Ω–¥—ã
```

**–ó–∞–ø—É—Å–∫ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º:**
```
Alex Personal: 1 transaction (–æ–±–Ω–æ–≤–∏—Ç—å –∑–µ—Ä–∫–∞–ª–æ)
Total time: ~3 —Å–µ–∫—É–Ω–¥—ã
```

---

## üéØ –ò—Ç–æ–≥–æ

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é (Personal ‚Üî Companies)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–µ—Ä–∫–∞–ª
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ/–ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ
- ‚úÖ –ó–∞—â–∏—Ç—É –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–µ—Ä–∫–∞–ª
- ‚úÖ –ó–∞—â–∏—Ç—É –æ—Ç –¥—É–±–ª–µ–π –∏ —Ü–∏–∫–ª–æ–≤
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –≤–∞–ª—é—Ç EUR ‚Üî USD
- ‚úÖ –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Delta API
- ‚úÖ –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞–π–º—ã –º–µ–∂–¥—É –ª–∏—á–Ω—ã–º –±—é–¥–∂–µ—Ç–æ–º –∏ –±—é–¥–∂–µ—Ç–∞–º–∏ –∫–æ–º–ø–∞–Ω–∏–π –≤—Å–µ–≥–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! üéâ



